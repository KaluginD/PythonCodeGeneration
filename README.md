# PythonCodeGeneration
Generation of python script based on yaml description of experiment

Based on [MLDev project](https://gitlab.com/mlrep/mldev).

WIP: The repository currently contains the first draft of the project. 

The generation is based on jinja2 templates (see [GenericPipeline2_tmpl.py](https://github.com/KaluginD/PythonCodeGeneration/blob/main/template/GenericPipeline2_tmpl.py)).
They use parsed yaml experiment configuration reorganised in the following way:
```
config = {
  'BasicStage': [list of basic stages],
  'GenericPipeline': [list of generic pipelines],
}
```
Each Stage is described by its ``name, params, env, inputs, outputs, script``.

Each GenericPipeline is described by its ``name, runs, stages, services``.

The scripts are generated by ``expanded_script_generator.py`` script. It:
  1. parses the yml files from ``yaml_examples`` directory, 
  2. passes them into jinja2 template ``template/GenericPipeline2_tmpl.py``,
  3. stores the results at ``generated_scripts/expanded_scripts``.

Currently there are 2 examples: for ``experiment-basic.yml`` and ``prepare_train.yml``.

To reproduce the results run:
```python main.py```

Requires MLDev, jinja2, pyyaml.

#TODO: 
  1. Support of services: TensorBoardService, NgrokService, NotificationBot, ModelControllerService
  2. Processing of expressions like: ``${self.params.num_iters}, ${env.PYTHONPATH}``
  3. Processing of nested yaml structures like:
```
params:
        <<: *bandit_loop_params
        experiment:
          <<: *default_experiment
          T: 1000
          # for this pipeline we redefine some parameters
          # and use the ones from the environment
          # they will still be in the json dump
          w: ${env.w}
```
